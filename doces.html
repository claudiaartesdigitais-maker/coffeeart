<script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQKD0m6_S6gmLU6rraasr75cUk5Nt2O6Lbsl2v3Lcwj5y0DMlrnuLHo_hzFPT6f3kqzHoUbHY2utFO3/pub?output=csv';
    const CATEGORIA_PARA_FILTRAR = "DOCES"; 

    // Função para garantir que o preço não venha duplicado ou com R$ extras
    function limparPreco(valor) {
        if (!valor) return "";
        // Remove "R$", espaços e aspas se houver
        return valor.replace(/R\$/g, '').replace(/"/g, '').trim();
    }

    async function fetchMenu() {
        try {
            const response = await fetch(CSV_URL + '&t=' + Date.now());
            const data = await response.text();
            const rows = data.split('\n').slice(1);
            const container = document.getElementById('menu-container');
            container.innerHTML = '';

            rows.forEach(row => {
                const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if (cols.length >= 3) {
                    const catPlanilha = cols[0]?.replace(/"/g, '').trim().toUpperCase();
                    
                    if (catPlanilha === CATEGORIA_PARA_FILTRAR) {
                        const nome = cols[1]?.replace(/"/g, '').trim();
                        
                        // LIMPEZA AQUI:
                        const precoBase = limparPreco(cols[2]);
                        const sugestao = cols[3]?.replace(/"/g, '').trim();
                        const precoAdicional = limparPreco(cols[4]);
                        const precoTotal = limparPreco(cols[5]);
                        
                        const foto = cols[6]?.replace(/"/g, '').trim();

                        let htmlAdicional = "";
                        if (sugestao && sugestao.toLowerCase() !== "não consta" && sugestao.trim() !== "") {
                            htmlAdicional = `
                                <div class="bloco-adicionais">
                                    <div class="linha-sugestao">Sugestão: ${sugestao}</div>
                                    <div class="linha-valor-adicional">Valor do adicional: R$ ${precoAdicional}</div>
                                    <div class="linha-total">
                                        <span>Total com adicional</span>
                                        <span>R$ ${precoTotal}</span>
                                    </div>
                                </div>
                            `;
                        }

                        container.innerHTML += `
                            <div class="item-card">
                                <div class="topo-item">
                                    ${foto ? `<img src="${foto}" class="item-foto">` : '<div class="item-foto" style="display:flex;align-items:center;justify-content:center"><i class="fas fa-utensils" style="color:#ccc"></i></div>'}
                                    <div class="item-info">
                                        <span class="item-nome">${nome}</span>
                                        <span class="item-preco-base">R$ ${precoBase}</span>
                                    </div>
                                </div>
                                ${htmlAdicional}
                            </div>
                        `;
                    }
                }
            });
        } catch (e) {
            container.innerHTML = '<p style="text-align:center; padding:20px;">Atualizando cardápio...</p>';
        }
    }
    fetchMenu();
</script>
